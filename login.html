<html>
<head>
    <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/2.3.0/weui.min.css"/>
    <style type="text/css">
    body{
        font-size: large;
    }
    button{
        width: 100%;
        font-size: large;
    }
    .weui-btn_mini{
        font-size: 50px;
    }
    .weui-input-font-size{
        padding-top: 20ex;
        font-size: 40px;
    }
    </style>
</head>
<body style="padding: 20ex;">
    <div class="page" style="width: 100%;">
        <div class="page__hd" style="text-align: center;border: 20ex;">
            <h1 class="page__title">Get Code via CorpId, AgentId, UserId</h1>
        </div>
        <div class="page__bd" style="width: 100%;text-align: center;">
            <h4 class="weui-media-box__title weui-input-font-size">code:</h4>
            <input type="text" class="weui-input" id="code">
            <h4 class="weui-media-box__title weui-input-font-size">User ID:</h4>
            <input type="text" class="weui-input" style="font-size: xx-large;" id="uname">
            <h4 class="weui-media-box__title weui-input-font-size">Access Token:</h4>
            <input type="text" class="weui-input" style="font-size: xx-large;" id="accesstoken">
            <div id="show"></div>
            <div class="button-sp-area">
                <button onclick="sendUrl()" style="width:100%;border: 20ex;" class="weui-btn weui-btn_mini weui-btn_primary wechat-ui-font-size">Get Code</button>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        // wx.ready(function(){

        // });
        // wx.error(function(){

        // });
        // wx.config({
        //     beta: true,
        //     debug: true,
        //     appId:'ww02b5c5e4d4868f46',
        //     timestamp:111,
        //     nonceStr:'',
        //     signature:'',
        //     jsApiList:[]
        // });
        // wx.checkJsApi({
        //     jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
        //     success: function(res) {
                
        //     }
        // });
        
        function getUrlVars() {
            var vars = [],
                hash;
            var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < hashes.length; i++) {
                hash = hashes[i].split('=');
                vars.push(hash[0]);
                vars[hash[0]] = hash[1];
            }
            return vars;
        }
        
        var accesstoken = '12';
        $.ajax({
            url: 'http://117.78.7.87:8081/wework/cgi-bin/gettoken?corpid=ww02b5c5e4d4868f46&corpsecret=A_9ZMXhRoR5Upg4IL8wAhZpN9gzPqJ1DXNF4xy2Y4EQ',
            method: 'GET',
            success: function(data){
                accesstoken = data.access_token;
                return accesstoken;
                console.log(accesstoken);
            },
            error: function(jqXHR, textStatus, errorThrown){
                console.log('fail');  
            } 
        });

        var code = getUrlVars()["code"];

        console.log('token: '+accesstoken);
        
        function sendUrl(){
            $('#uname').val(code);
            $('#accesstoken').val(accesstoken);
            $.ajax({
            url: 'http://117.78.7.87:8081/wework/cgi-bin/user/getuserinfo?access_token='+accesstoken+'&code='+code,
            method: 'GET',
            success: function(data){
                var jsn=JSON.stringify(data);
                $("#uname").val(data.UserId);
                $('#code').val(code);
            },
            error: function(jqXHR, textStatus, errorThrown){
                $('#uname').val(jqXHR.status+'-jqhr-'+jqXHR.responseText+'-status-'+errorThrown);
                $('#code').val(code);
            }
            });
        }
        function setVal(){
            $('#uname').val(data);
        }
        </script>
</body>
</html>